<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login Tarjeta de Fidelidad - Zavdu</title>
<style>
  /* Reset y base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Times New Roman', serif;
    background: #000000;
    color: #bfa94a;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .container {
    background: #121212;
    border: 1.5px solid #bfa94a;
    border-radius: 10px;
    padding: 24px 28px;
    width: 100%;
    max-width: 400px;
    box-shadow:
      0 0 8px #bfa94a88,
      inset 0 0 10px #bfa94a44;
  }
  h2 {
    text-align: center;
    margin-bottom: 24px;
    font-weight: 400;
    letter-spacing: 2px;
    font-size: 1.6rem;
    color: #d4af37;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 400;
    color: #bfa94a;
    font-size: 0.95rem;
  }
  input[type="email"],
  input[type="password"],
  input[type="text"] {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 18px;
    border: 1.2px solid #bfa94a;
    border-radius: 6px;
    background: #1a1a1a;
    color: #bfa94a;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    font-family: 'Times New Roman', serif;
  }
  input[type="email"]:focus,
  input[type="password"]:focus,
  input[type="text"]:focus {
    outline: none;
    border-color: #fff;
    background: #222;
  }
  button {
    width: 100%;
    padding: 12px;
    background: linear-gradient(90deg, #d4af37, #bfa94a);
    border: none;
    border-radius: 6px;
    font-weight: 600;
    color: #000;
    font-size: 1.1rem;
    cursor: pointer;
    font-family: 'Times New Roman', serif;
    transition: background 0.3s ease;
  }
  button:hover {
    background: linear-gradient(90deg, #bfa94a, #d4af37);
  }
  .forgot-pass {
    margin-top: 10px;
    text-align: center;
    color: #bfa94a;
    cursor: pointer;
    user-select: none;
    font-size: 0.9rem;
    font-family: 'Times New Roman', serif;
    text-decoration: underline;
    transition: color 0.3s ease;
  }
  .forgot-pass:hover {
    color: #fff;
  }
  .message {
    margin: 14px 0 0 0;
    text-align: center;
    font-weight: 400;
    font-size: 1rem;
    min-height: 20px;
    font-family: 'Times New Roman', serif;
  }
  .hidden {
    display: none;
  }
  /* Tarjeta fidelidad horizontal */
  .card {
    background: #1a1a1a;
    border: 1.5px solid #bfa94a;
    border-radius: 10px;
    padding: 16px 24px;
    margin-top: 28px;
    display: flex;
    align-items: center;
    gap: 18px;
    box-shadow:
      0 0 10px #bfa94a77;
  }
  .card h3 {
    flex-shrink: 0;
    margin: 0;
    font-weight: 600;
    font-size: 1.3rem;
    color: #d4af37;
    min-width: 130px;
  }
  .stamps {
    display: flex;
    gap: 8px;
    flex-wrap: nowrap;
  }
  /* Palomita SVG (gold) */
  .stamp-gold svg path {
    fill: #d4af37;
    filter: drop-shadow(0 0 1px #bfa94aaa);
  }
  /* Palomita SVG (gray) */
  .stamp-gray svg path {
    fill: #555555;
  }
  .card p.thanks {
    font-size: 0.9rem;
    font-weight: 400;
    color: #bfa94a;
    margin-left: auto;
    font-style: italic;
  }
  #logout-btn {
    margin-left: 24px;
    background: #bfa94a;
    color: #000;
    font-family: 'Times New Roman', serif;
    font-weight: 600;
    border-radius: 6px;
    border: none;
    padding: 10px 18px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #logout-btn:hover {
    background: #d4af37;
  }
</style>
</head>
<body>
<div class="container" id="login-container">
  <h2>Accede a tu tarjeta</h2>
  <form id="login-form">
    <label for="correo">Correo electrónico</label>
    <input type="email" id="correo" name="correo" placeholder="tu@correo.com" required autocomplete="username" />
    <label for="contrasena">Contraseña</label>
    <input type="password" id="contrasena" name="contrasena" placeholder="Contraseña" required autocomplete="current-password" />
    <button type="submit">Iniciar sesión</button>
  </form>
  <div class="forgot-pass" id="forgot-password">¿Olvidaste tu contraseña?</div>
  <div class="message" id="message"></div>
</div>

<div class="container hidden" id="card-container">
  <h2>Bienvenido, <span id="nombreUsuario"></span></h2>
  <div class="card">
    <h3>Tu cantidad de sellos</h3>
    <div class="stamps" id="stamps"></div>
    <p class="thanks">Gracias por tu compra. Estamos muy agradecidos.<br>— Equipo Zavdu</p>
    <button id="logout-btn">Cerrar sesión</button>
  </div>
</div>

<script>
  const baseUrl = 'https://script.google.com/macros/s/AKfycbw25H5KEveG9_UxUiPWIpy1DMl9sKAywGmx9gBm-QCQZQ0hu7vXYvdQUPxj8lcWtYQ8/exec';

  const loginContainer = document.getElementById('login-container');
  const cardContainer = document.getElementById('card-container');
  const loginForm = document.getElementById('login-form');
  const messageDiv = document.getElementById('message');
  const forgotPassDiv = document.getElementById('forgot-password');
  const nombreUsuarioSpan = document.getElementById('nombreUsuario');
  const stampsDiv = document.getElementById('stamps');
  const logoutBtn = document.getElementById('logout-btn');

  function mostrarMensaje(text, color = '#bfa94a') {
    messageDiv.textContent = text;
    messageDiv.style.color = color;
  }

  // SVG palomita dorada
  const svgGold = `<svg width="22" height="22" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" >
    <path d="M9 16.2l-3.5-3.5 1.4-1.4L9 13.4l7.1-7.1 1.4 1.4z"/>
  </svg>`;

  // SVG palomita gris (sellos vacíos)
  const svgGray = `<svg width="22" height="22" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" >
    <path d="M9 16.2l-3.5-3.5 1.4-1.4L9 13.4l7.1-7.1 1.4 1.4z" fill="#555555"/>
  </svg>`;

  function renderSellos(sellos) {
    stampsDiv.innerHTML = '';
    const maxSellos = 10; // total sellos posibles
    for(let i=1; i <= maxSellos; i++) {
      const span = document.createElement('span');
      if(i <= sellos) {
        span.className = 'stamp-gold';
        span.innerHTML = svgGold;
      } else {
        span.className = 'stamp-gray';
        span.innerHTML = svgGray;
      }
      stampsDiv.appendChild(span);
    }
  }

  loginForm.addEventListener('submit', async e => {
    e.preventDefault();
    mostrarMensaje('Iniciando sesión...');

    const correo = loginForm.correo.value.trim();
    const contrasena = loginForm.contrasena.value.trim();

    try {
      const res = await fetch(`${baseUrl}?accion=login&correo=${encodeURIComponent(correo)}&contrasena=${encodeURIComponent(contrasena)}`);
      const data = await res.json();

      if (data.success) {
        mostrarMensaje('');
        nombreUsuarioSpan.textContent = data.nombre || correo;
        renderSellos(Number(data.sellos) || 0);
        loginContainer.classList.add('hidden');
        cardContainer.classList.remove('hidden');
      } else {
        mostrarMensaje('Correo o contraseña incorrectos', 'red');
      }
    } catch (error) {
      mostrarMensaje('Error al conectar con el servidor', 'red');
      console.error(error);
    }
  });

  forgotPassDiv.addEventListener('click', () => {
    const correo = prompt('Por favor, escribe tu correo para recuperar la contraseña:');
    if (!correo) return;

    mostrarMensaje('Enviando correo de recuperación...');

    fetch(`${baseUrl}?accion=recuperar&correo=${encodeURIComponent(correo.trim())}`)
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          mostrarMensaje('Correo enviado con éxito. Revisa tu bandeja.');
        } else {
          mostrarMensaje('Correo no encontrado.', 'red');
        }
      })
      .catch(() => mostrarMensaje('Error al conectar con el servidor', 'red'));
  });

  logoutBtn.addEventListener('click', () => {
    nombreUsuarioSpan.textContent = '';
    stampsDiv.innerHTML = '';
    cardContainer.classList.add('hidden');
    loginContainer.classList.remove('hidden');
    mostrarMensaje('');
    loginForm.reset();
  });
</script>
</body>
</html>